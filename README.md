项目简介
----------------

go-webdav-virtual 是一款基于 Go 语言开发的虚拟 WebDAV 服务程序，通过对接115开放平台，实现将云端目录以 WebDAV 形式对外提供访问和视频播放。


功能特点
----------------

1. 虚拟挂载：将115网盘中的某个目录映射为 WebDAV 的访问入口，方便在各类客户端中统一访问。
2. 自动同步：支持增量同步与全量同步，定期刷新目录和文件信息，保持与115网盘一致。
3. 令牌刷新：支持使用刷新令牌自动更新访问令牌，减少手动维护成本。
4. 视频直链缓存：为视频等大文件提供缓存机制，降低重复访问时对远程接口的压力。
5. 按后缀转发：可根据文件后缀控制哪些文件类型通过转发方式访问，灵活适配不同使用场景。


软件核心优势
----------------

1. 网易爆米花极速扫描与导入：对目录进行高效遍历与索引构建，最大程度避免文件遗漏，适合大体量资源库。
2. 起播迅速并带缓存：优化播放地址获取流程并引入缓存机制，大幅降低爆米花获取不到 WebDAV 播放地址或长时间转圈的情况。
3. 友好防风控策略：通过合理的同步与访问调度，避免因刮削过快或频繁播放触发平台封控、限频，让长期运行更加稳定。
4. 新增文件秒级生效：新上传的文件通常在数秒内即可同步完成并在客户端中展示。
5. 原生支持爆米花下载：在保留 WebDAV 功能的同时，兼容爆米花的下载行为，弥补原 openlist 下载失败的不足。
6. 自动刷新授权令牌：内置 Token 定时刷新机制，只需授权一次即可长期使用，无需频繁手动更新授权信息。


发行包内容
----------------

典型的发行包内容包括：

1. 主程序
   - Windows 平台为 `go-webdav-virtual.exe` ，Linux 平台为 `go-webdav-virtual`
   - 配置文件：config.ini

2. 配置文件
   - `config.ini`


配置文件说明（config.ini）
----------------

config.ini 是本程序的核心配置文件，位于程序所在目录。部署前需要根据实际情况进行修改。主要配置项说明如下（均位于 vfs 配置段内）：

1. enabled
   - 含义：是否启用与115网盘的同步功能。
   - 取值：true 表示启用，false 表示关闭。
   - 建议：正常使用建议启用。

2. access_token
   - 含义：访问115网盘接口所需的访问令牌。
   - 获取：在115网盘或云盘平台中，通过相关授权流程获取。
   - 注意：属于敏感信息，请妥善保管，避免泄露。

3. refresh_token
   - 含义：用于自动刷新访问令牌的刷新令牌。
   - 作用：程序会定期使用该令牌来更新 access_token，确保长时间运行不因令牌过期导致中断。
   - 注意：同样属于敏感信息，不应泄露给无关人员。

4. mount_dir_id
   - 含义：在115网盘中需要挂载的目录编号。
   - 约定：打开 115 网盘官网，点击进入要设置的文件夹时点击 URL 中 `cid` 后面的数字如https://115.com/?cid=249163533602609229&offset=0&tab=&mode=wangpan，这个文件夹的 根文件夹ID 即为 `249163533602609229` ，通常根目录可填写为 0。

5. mount_dir_path
   - 含义：与挂载目录编号对应的人类可读路径。
   - 要求：必须与115网盘中的真实路径一致，例如根目录可使用 / 表示。

6. cache_time
   - 含义：视频等文件链接的缓存时长，单位为秒。
   - 作用：在缓存有效期内，多次访问同一资源时可以减少向远程平台的重复请求，提高访问效率。
   - 建议：根据访问频率和平台的限流策略设定合适数值，时间过短会导致频繁请求，时间过长则可能导致配置变更生效较慢。

7. forward_file_ext
   - 含义：待同步文件后缀列表，不在列表内的文件不会同步。
   - 格式：由多个后缀组成，使用英文逗号分隔，例如常见的视频、字幕和镜像格式。
   - 建议：只保留实际需要的后缀类型，以避免不必要的同步开销。

8. sync_frequency
   - 含义：增量同步的执行间隔，单位为秒。
   - 作用：周期性检查并同步115网盘中新增的文件，移动、重命名和删除的文件无法监测。
   - 建议：保持适度的频率，过低的间隔可能导致请求过于频繁，存在触发风控的风险。

9. full_sync_frequency
   - 含义：全量同步的执行间隔，单位为秒。
   - 作用：定期从头遍历远程目录结构，校验并更新本地索引，新增、移动、重命名和删除的文件均可监测。
   - 建议：由于全量同步开销较大，建议设置为较长的间隔，根据数据规模酌情调整。

10. refresh_token_frequency
    - 含义：刷新访问令牌的时间间隔，单位为秒。
    - 作用：在令牌即将过期前自动进行刷新，避免服务中断。
    - 建议：一定不能设置小，否则可能会触发风控。

配置文件修改保存后立刻生效。

获取令牌
----------------
1. 访问 [api.oplist.org](https://api.oplist.org/)
2. 在下拉框中选择 115 验证网盘，勾选 `使用 OpenList 提供的参数`<br><br>
![](https://tncache1-f1.v3mh.com/image/2025/12/03/10b1eb3d66f34a825a8fae8b9b08219f.png)<br><br>
3. 点击 `获取Token` 按钮，在弹出的窗口中，登录你的 115 账号，并授权 OpenList 访问你的 115 网盘。
4. 授权成功后，页面会显示你的 `访问令牌（Access Token）` 和 `刷新令牌（Refresh Token）`，请复制并分别填写到配置文件内的 `access_token` 和 `refresh_token` 后。<br><br>
![](https://tncache1-f1.v3mh.com/image/2025/12/03/0076ef38221142a7e7dcbb29b0af0dc0.png)

Windows 部署
----------------

1. 文件准备
   - 在任意磁盘新建一个目录，用于存放程序和配置文件。
   - 将 Windows 平台的主程序以及 config.ini 文件一起放入该目录。

2. 配置修改
   - 使用文本编辑器打开 config.ini。
   - 根据上述配置项说明，填写或修改访问令牌、刷新令牌、挂载目录以及同步和缓存相关参数。

3. 启动程序
   - 直接双击主程序来启动。

4. 停止与重启
   - 关闭对应窗口来停止。


Linux 部署
----------------

1. 目录规划与文件上传
   - 在服务器上规划一个安装目录，例如位于系统的应用目录下。
   - 将 Linux 平台的主程序和 config.ini 上传到该目录。

2. 配置修改
   - 在服务器上使用文本编辑工具打开 config.ini。
   - 按配置说明填写访问令牌、刷新令牌、挂载目录以及同步和缓存相关参数。

3. 启动与后台运行
   - 进入软件解压文件夹，终端执行 `sudo chmod +x go-webdav-virtual` ，授予软件运行权限。
   - 终端执行 `nohup ./go-webdav-virtual &` ，软件即可后台运行。

4. 停止
   - 终端执行 `sudo killall -9 go-webdav-virtual`


WebDAV客户端参数填写
----------------
   - 协议：`HTTP`
   - 地址：安装软件的机器IP，如果是本地就填127.0.0.1
   - 端口：`5574`
   - 用户名、密码留空。
   - 路径：`/dav/`
   <br><br>
![](https://tncache1-f1.v3mh.com/image/2025/12/03/6e1c9f2921140d401d5e3078907b556b.jpg)


